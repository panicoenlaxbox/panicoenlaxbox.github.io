<!doctype html><html lang=es itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Configuración y secretos en ASP.NET Core con Azure Key Vault y Azure App Configuration - Programación desordenada</title><meta name=description content="Configuración y secretos, un tandem a resolver para cualquier aplicación."><meta name=author content="Sergio León"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Programación desordenada","url":"https:\/\/panicoenlaxbox.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/panicoenlaxbox.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/panicoenlaxbox.com","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/panicoenlaxbox.com\/post\/configuration-and-secrets-in-asp-net-core\/","name":"Configuración y secretos en asp. net core con azure key vault y azure app configuration"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Sergio León"},"headline":"Configuración y secretos en ASP.NET Core con Azure Key Vault y Azure App Configuration","description":"Configuración y secretos, un tandem a resolver para cualquier aplicación.\n","inLanguage":"es","wordCount":1705,"datePublished":"2022-04-09T00:00:00","dateModified":"2022-04-09T00:00:00","image":"https:\/\/panicoenlaxbox.com\/img\/avatar-icon.png","keywords":["asp.net, csharp"],"mainEntityOfPage":"https:\/\/panicoenlaxbox.com\/post\/configuration-and-secrets-in-asp-net-core\/","publisher":{"@type":"Organization","name":"https:\/\/panicoenlaxbox.com","logo":{"@type":"ImageObject","url":"https:\/\/panicoenlaxbox.com\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="Configuración y secretos en ASP.NET Core con Azure Key Vault y Azure App Configuration"><meta property="og:description" content="Configuración y secretos, un tandem a resolver para cualquier aplicación."><meta property="og:image" content="https://panicoenlaxbox.com/img/avatar-icon.png"><meta property="og:url" content="https://panicoenlaxbox.com/post/configuration-and-secrets-in-asp-net-core/"><meta property="og:type" content="website"><meta property="og:site_name" content="Programación desordenada"><meta name=twitter:title content="Configuración y secretos en ASP.NET Core con Azure Key Vault y Azure …"><meta name=twitter:description content="Configuración y secretos, un tandem a resolver para cualquier aplicación."><meta name=twitter:image content="https://panicoenlaxbox.com/img/avatar-icon.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@panicoenlaxbox"><meta name=twitter:creator content="@panicoenlaxbox"><link href=https://panicoenlaxbox.com/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.115.2"><link rel=alternate href=https://panicoenlaxbox.com/index.xml type=application/rss+xml title="Programación desordenada"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://panicoenlaxbox.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://panicoenlaxbox.com/css/highlight.min.css><link rel=stylesheet href=https://panicoenlaxbox.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><style>.intro-header .archive-heading{text-align:center}.intro-header .archive-heading h1{margin-top:0;font-size:50px}@media only screen and (min-width:768px){.intro-header .archive-heading h1{font-size:80px}}.post-entry a{color:#008aff}body.dark-mode,body.dark-mode main *{background:#2d2d2d;color:#f5f5f5}body.dark-mode .post-title,body.dark-mode .post-subtitle{color:#f5f5f5}body.dark-mode .post-entry a{color:#008aff}body.dark-mode table tr th,body.dark-mode table tr td{color:#333}blockquote{margin:20px}table{margin-top:10px}</style><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-57023975-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Conmuta navegación</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://panicoenlaxbox.com>Programación desordenada</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Tags href=/tags>Tags</a></li><li><a title=Archive href=/archive>Archive</a></li><li><a title=About href=/about>About</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Programación desordenada" href=https://panicoenlaxbox.com><img class=avatar-img src=https://panicoenlaxbox.com/img/avatar-icon.png alt="Programación desordenada"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Configuración y secretos en ASP.NET Core con Azure Key Vault y Azure App Configuration</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Publicado el April 9, 2022</span></div></div></div></div></div></header><div class=js-toggle-wrapper><div class=js-toggle><div class=js-toggle-track><div class=js-toggle-track-check><img src="data:image/png;base64,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" role=presentation style=pointer-events:none width=16 height=16></div><div class=js-toggle-track-x><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAABwNJREFUWAmtV1tsFFUY/s6Z2d22zLYlZakUCRVaQcqlWIiCiS1gTEB9UAO+GR9En3iQGI0xJiSiRB98MjEq8cEQTSBeHhQM0V7whtEGDWC90BYitxahtNtu25058/v/ZzvLbilawJNM5+yZ89+//1LgJhYRNLW1uDfBAvpGiIk2O5auvfFxqIH3ZJ8/u06GN6Z9+wVl5SjcD1IbZa/UPkPyYl2uR4dreoD2bnbYxTlBBRytkHXtAREphP5KuH4lddx9h70yxX05t7yYXwGb6W8nx1jibpl2rFlGBxcG9M18okOrn7Bnk/BAO/4bI0UeEE1zjBp3UmvjOxJXJdaKN/ZiIu4tOZrAb4aTdZAZArKmWeiiJZ6jt5tiagdCS9+6cgO1Ne6Mvhe+ixTIfyDVhipnK9p+P0Edqx9RW/YZtQVGmOLChRxNNlyPsTEgPQKMB3dbEHa0h1awYmQ83enTd2vmUtvKd1Glv2RkzBb+kZGRrKtjzG60Wguhd/lJZBingbcfWWe72vjT75bJDrhYtvA0hrurETDr5HyF2Knb1MM4ab//xIoOqueA0edRnkkinTyJdYvqLFDZO4zUPFCvVoDjJq4T7TE61IWh4x5KqxX5KVKkX8WZ/t2ov2cb3MHt4dhIyOxIJxJOOF6xRx/99BksXLoecWcXytILMNBDqKpnGZWPquYfPxY8iXGR9fK+SgFrgcRPXPjVqhehL+3EmZ5RGJQi1QBU8TPThQnOQzm+5UXGIcetUeEAfP13VwzpI+w1jGJWdSliNfvVhiMPiOsllJag4M/UGHiqM6dlBb2OTLKHHV6KkvogrJ4XhBWniWK/Gp1MQyf93FOeUXKmKk/FzJxbQtKLjFXYT4USupy8fQVir2ynVEBiZMG0qtOHMS/AW4Gwrk7BG3C1F0B5nqNKE0CME4MfVRLPnXkBKe+ipvoFhNQywOhdghvLi0F8ReyVXV4BKTBRbbe5f64zR/DHsdZw1hJfeWlHl/GNRJzDxrd5m192z78TMaVnKELZoINZS4BzQ7vtnZljSnha/pPCbkuxzXcupYwI5tIeCpGc0Yp9tWHZQy/rmYhRfNgg4bHJBYLzGkxsRJF4XKlE2jBOHNSv3kY7Tj6vthzPFl61BrYwqFlmEQhtSVXmLiksxLmtRgYXI1ULU61JJ4eVKmG3/5sCVgpbMT6OMJ2E08/29Xf3w6v4FnHdCjfWgXu/O8Z5mLdCkeRs2khHe1DqOtQwbHWTAnM5S2HNmhALYo5KjkPFrMMKjZl6HxhWIAb0BqE+/73GrBRQUsKYiBu4JX8ycI6wtw+i5ef3NZpsrKVSHYCP37jwGDgeE1SA0S/xtl5SU2fs1ApEp0qTLVRjgyycDSsLHMSwmFltZMStR3uLLg6BdLhDa5dC6ryU2pHBe1BVO9tUcwfitJt2CLJZUHoG6T7Op75u0IyK31TCPcwFqgPk/KCaD3dFOuZBCO7xvCT/j048b3I3c7F2+WuOW7qdgkucFYlcQ4qop3yzTX7WaKfOCccye3Ts1Etq0+a/BHCF1yPgF3tAUkR6OrtGmo6gl94qqcXKh3rDyrOkPa58URoWcov2Mo6M+0QjrqKB+b7++oMa9Sz+ZkM0mie6aAtnGUvhmxaI+TogPOSQedgWioGSHFLn3v4kLh4HRspNmOGv41k+55siLFp2z6xYeJjhljFcbmxJlr4ga06TbevSByz/glQq4BJx46/c+237PbBqEYKxX3HpmKZEnQnr65X20hqJYaNcLoFOLiJk2LuBbyg7Q0OEn+hm0P3honxFD6rdxYorKpeIoi4YSSvyQHQIbM5t4+YNxLj/OxhVOOE4585qGpjnq+wSx6Q9CtNxTjd5klB+g6Mv36r0+b9cZFi44WYkHdG2ZWb3TtOUOXyVAlKlpGvJIAJ3eBMyfYS5C0qRZGtC85j+4sOasDe9xznPYezhhO/2Q6eP2fSOvYHOjtuQ1a9Q1VKynVDaMc8E0tptdxUsTFpFIYjcZKcbnoaQTNdiqCwNlL4G7oziSqGnT1ALf34vhk4R5zU3qYV9ONp9K88RtouShE68JwaU8dFw5W617shWa9ykeaBIn2hcsvPgL00k45QdTCZuSVcTRNs+8fnyLvooQfR5iujAnR9bxfY2xOVOxFS8SK3Le0l48VyYu1M8HRe5JD8wKPTjYnifaK3Wfn/GChYQ8ZAi6WRzWgqLV5YrsVLnZaVSoXU1g9gOIDwFySiGi+Zdrnzr7J3r+SMuszlcQCRn8lNGcTuSy2jOI7o9mxjZo+vR3ej3tN+ifRSOyUTS0+VMOid93cCubeiy/6TImS0QxRSCq2vxKr45zV+FQnjWH6D2xg+E9EatLcLAdHTgtGGD80D6jM0+aOl4wJgO/f96R2aJKCQ3yvgftRhdFMOpd6oAAAAASUVORK5CYII=" role=presentation style=pointer-events:none width=16 height=16></div></div><div class=js-toggle-thumb></div><input class=js-toggle-screenreader-only type=checkbox aria-label="Switch between Dark and Light mode"></div></div><style>.js-toggle-wrapper{display:table;margin:0 auto}.js-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-tap-highlight-color:transparent}.js-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.js-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.js-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.js-toggle--checked .js-toggle-track-check{opacity:1;transition:opacity .25s ease}.js-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:1;transition:opacity .25s ease}.js-toggle--checked .js-toggle-track-x{opacity:0}.js-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1)0ms;transform:translateX(0)}.js-toggle--checked .js-toggle-thumb{transform:translateX(26px);border-color:#19ab27}.js-toggle--focus .js-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.js-toggle:active .js-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><script>var body=document.body,switcher=document.getElementsByClassName("js-toggle")[0];switcher.addEventListener("click",function(){this.classList.toggle("js-toggle--checked"),this.classList.add("js-toggle--focus"),this.classList.contains("js-toggle--checked")?(body.classList.add("dark-mode"),localStorage.setItem("darkMode","true")):(body.classList.remove("dark-mode"),setTimeout(function(){localStorage.removeItem("darkMode")},100))}),localStorage.getItem("darkMode")&&(switcher.classList.add("js-toggle--checked"),body.classList.add("dark-mode"))</script><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Configuración y secretos, un tandem a resolver para cualquier aplicación.</p><p>Probablemente, nuestra primera intención cuando se habla de usar configuración en una aplicación de ASP.NET Core, sea usar el famoso y manido fichero <code>appsettings.json</code> y <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-6.0">sus amigos</a> <code>appsettings.&lt;Environment>.json</code>. Puede que incluso en nuestra pipeline de CD, hagamos un reemplazo de ciertos valores en el fichero <code>appsettings.json</code> leyéndolos previamente desde un Key Vault, bien usando <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/release/azure-key-vault?view=azure-devops">Azure Devops</a> o bien <a href=https://docs.microsoft.com/en-us/azure/developer/github/github-key-vault>GitHub Actions</a>. En esta pipeline, y si estamos usando un App Service, otra práctica habitual sería configurar las <a href="https://docs.microsoft.com/en-us/azure/app-service/configure-common?tabs=portal">app settings</a>, pudiendo ser alguna de ellas una <a href=https://docs.microsoft.com/en-us/azure/app-service/app-service-key-vault-references>referencia a un secreto de Key Vault</a>. Por último, en tiempo de desarrollo lo más seguro es que usemos los <a href="https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets?view=aspnetcore-6.0&amp;tabs=windows">secretos de usuario</a> para evitar la tentación de subir secretos al repositorio.</p><p>Todo lo expuesto en el anterior párrafo (que ha quedado compacto, lo sé), parece la forma más habitual de gestionar la configuración y los secretos en una aplicación <em>&ldquo;tipo&rdquo;</em> de ASP.NET Core.</p><p>Antes de continuar, creo resultaría interesante debatir sobre la diferencia entre configuración y secretos. Aunque muchas veces se usan indistintamente, son cosas muy diferentes. Con la configuración estamos decidiendo como se comportará nuestra aplicación. Por el contrario, con los secretos estamos guardando <em>&ldquo;credenciales&rdquo;</em> para acceder a servicios que requieren autenticación. Esto supone que si se compromete la configuración, no debería suponer un problema mayúsculo (no está bien, es obvio, pero el daño debería ser mínimo). Sin embargo, si se comprometen los secretos (que son privados por naturaleza), ahí sí va a morir un gatito&mldr; la habremos <a href="https://www.youtube.com/watch?v=QNTZbJSQVis">liado parda</a>. Los secretos hay que mantenerlos siempre fuera de miradas indiscretas e incluso es probable que, en un equipo de desarrollo, no se tenga acceso a los secretos de producción. En cualquier caso, esta distinción daría para un post entero&mldr; para el que yo no estoy plenamente cualificado.</p><p>Aunque el uso de app settings en un App Service parece una buena idea, presenta los siguientes problemas:</p><ul><li>Cualquier cambio en la configuración de la aplicación supondrá un reinicio de la misma.</li><li>Si además, estamos usando una referencia a un Key Vault y el valor del secreto cambia, la actualización en el App Service no va a ser inmediata. El compromiso es que el valor se actualizará en las <a href=https://docs.microsoft.com/en-us/azure/app-service/app-service-key-vault-references#rotation>siguientes 24 horas</a>&mldr; dependiendo del caso, un mundo.</li></ul><p>En esta situación (y teniendo que soportar el cambio de valor de un secreto), nos va a tocar leerlo en caliente.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>dotnet</span> <span class=n>add</span> <span class=n>package</span> <span class=n>Azure</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>KeyVault</span><span class=p>.</span><span class=py>Secrets</span>
</span></span><span class=line><span class=cl><span class=n>dotnet</span> <span class=n>add</span> <span class=n>package</span> <span class=n>Azure</span><span class=p>.</span><span class=py>Identity</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Azure.Identity</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Azure.Security.KeyVault.Secrets</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>WebApplication1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>KeyVaultManager</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=n>SecretClient</span> <span class=n>CreateSecretClient</span><span class=p>(</span><span class=kt>string</span> <span class=n>vaultUri</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>SecretClient</span><span class=p>(</span><span class=k>new</span> <span class=n>Uri</span><span class=p>(</span><span class=n>vaultUri</span><span class=p>),</span> <span class=k>new</span> <span class=n>DefaultAzureCredential</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=kt>string?</span><span class=p>&gt;</span> <span class=n>GetSecretAsync</span><span class=p>(</span><span class=kt>string</span> <span class=n>vaultUri</span><span class=p>,</span> <span class=kt>string</span> <span class=n>name</span><span class=p>,</span> <span class=kt>string?</span> <span class=n>version</span> <span class=p>=</span> <span class=k>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>secretClient</span> <span class=p>=</span> <span class=n>CreateSecretClient</span><span class=p>(</span><span class=n>vaultUri</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>secret</span> <span class=p>=</span> <span class=k>await</span> <span class=n>secretClient</span><span class=p>.</span><span class=n>GetSecretAsync</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>version</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>secret</span> <span class=k>is</span> <span class=n>not</span> <span class=k>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>secret</span><span class=p>.</span><span class=n>Value</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Respecto a la autenticación en el Key Vault, hay un montón de formas de hacerlo. <a href=https://azuresdkdocs.blob.core.windows.net/$web/dotnet/Azure.Identity/1.0.0/api/index.html#defaultazurecredential>DefaultAzureCredential</a> funcionará tanto en local como cuando la aplicación esté desplegada en Azure y usemos una Managed Identity.</p><p>Logicamente, el snippet anterior está pidiendo a gritos algún tipo de caché como <a href="https://docs.microsoft.com/en-us/aspnet/core/performance/caching/memory?view=aspnetcore-6.0">IMemoryCache</a> o <a href="https://docs.microsoft.com/en-us/aspnet/core/performance/caching/distributed?view=aspnetcore-6.0">IDistributedCache</a>. Key Vault tiene sus propios <a href=https://docs.microsoft.com/en-us/azure/key-vault/general/overview-throttling>límites de servicio</a> y si no tenemos cuidado, sufriremos un <em>throttling</em> con un bonito <code>429 (Too many requests)</code>.</p><p>Una alternativa a leer en caliente Key Vault, es usar la integración que tiene con el servicio común de configuración de ASP.NET Core.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>dotnet</span> <span class=n>add</span> <span class=n>package</span> <span class=n>Azure</span><span class=p>.</span><span class=py>Extensions</span><span class=p>.</span><span class=py>AspNetCore</span><span class=p>.</span><span class=py>Configuration</span><span class=p>.</span><span class=py>Secrets</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// KeyVault is retreived from appsettings.json</span>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>.</span><span class=n>AddAzureKeyVault</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Uri</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;KeyVault&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>DefaultAzureCredential</span><span class=p>());</span>
</span></span></code></pre></div><p>Ahora bastaría con inyectarnos <code>IConfiguration</code> y tendríamos todos los secretos a mano. Parece un buen trato.</p><p>Si quieres más control sobre que secretos se cargarán en configuración y cuando se renovarán, también puedes hacerlo. Por ejemplo, en el siguiente código filtramos los secretos a sólo aquellos que tengan un prefijo determinado y establecemos de forma explícita cuando volveremos a leerlos.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;KeyVault&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Uri&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_KEY_VAULT_URI&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_PREFIX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ReloadIntervalInMinutes&#34;</span><span class=p>:</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>.</span><span class=n>AddAzureKeyVault</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Uri</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;KeyVault:Uri&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>DefaultAzureCredential</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>AzureKeyVaultConfigurationOptions</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Manager</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SamplePrefixKeyVaultSecretManager</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;KeyVault:Prefix&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=n>ReloadInterval</span> <span class=p>=</span> <span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromMinutes</span><span class=p>(</span><span class=n>Convert</span><span class=p>.</span><span class=n>ToInt32</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;KeyVault:ReloadIntervalInMinutes&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span></code></pre></div><p>Si no te gusta <code>KeyVault:Uri</code>, puede usar <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-6.0">Options pattern</a> y quedaría mas chulo.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>KeyVaultOptions</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>string</span> <span class=n>Uri</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>string</span> <span class=n>Prefix</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>int</span> <span class=n>ReloadIntervalInMinutes</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>var</span> <span class=n>keyVaultOptions</span> <span class=p>=</span> <span class=k>new</span> <span class=n>KeyVaultOptions</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>.</span><span class=n>GetSection</span><span class=p>(</span><span class=s>&#34;KeyVault&#34;</span><span class=p>).</span><span class=n>Bind</span><span class=p>(</span><span class=n>keyVaultOptions</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>.</span><span class=n>AddAzureKeyVault</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Uri</span><span class=p>(</span><span class=n>keyVaultOptions</span><span class=p>.</span><span class=n>Uri</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>DefaultAzureCredential</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>AzureKeyVaultConfigurationOptions</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Manager</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SamplePrefixKeyVaultSecretManager</span><span class=p>(</span><span class=n>keyVaultOptions</span><span class=p>.</span><span class=n>Prefix</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=c1>// By default, it never reloads</span>
</span></span><span class=line><span class=cl>        <span class=c1>// https://docs.microsoft.com/es-es/aspnet/core/security/key-vault-configuration?view=aspnetcore-6.0#configuration-options</span>
</span></span><span class=line><span class=cl>        <span class=n>ReloadInterval</span> <span class=p>=</span> <span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromSeconds</span><span class=p>(</span><span class=n>keyVaultOptions</span><span class=p>.</span><span class=n>ReloadIntervalInMinutes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span></code></pre></div><p>El ejemplo de <code>SamplePrefixKeyVaultSecretManager</code> no es mío, es de la <a href="https://docs.microsoft.com/en-us/aspnet/core/security/key-vault-configuration?view=aspnetcore-6.0#use-a-key-name-prefix">documentación oficial</a>.</p><p>Usando Key Vault con el servicio común de configuración, <code>IConfiguration.Reload()</code> también forzará que se vuelvan a leer los secretos.</p><p>Hasta ahora, sólo hemos hablando de Key Vault, es decir, de secretos. Si lo queremos es tratar sobre configuración, Azure tiene otro servicio más preparado para ello que es Azure App Configuration.</p><p>Con App Configuration, no sólo tenemos una pareja <em>clave-valor</em>, sino que incorpora el concepto de <em>label</em> para tener distintos valores por clave. De este modo, tener distinta configuración por entorno es tan sencillo como etiquetarla con <em>dev</em>, <em>stage</em> o <em>prod</em>. Además, también podemos (igual que los app settings de un App Service) tener referencias a un Key Vault. Convirtiéndose así, en un único sitio donde centralizar la gestión de la configuración y secretos de nuestra aplicación.</p><p>Aunque podemos leer una <a href=https://github.com/Azure/azure-sdk-for-net/blob/main/sdk/appconfiguration/Azure.Data.AppConfiguration/samples/Sample1_HelloWorld.md#retrieve-a-configuration-setting>clave a pelo</a>, en App Configuration todo la documentación te sugiere usarlo como un proveedor de configuración.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>dotnet</span> <span class=n>add</span> <span class=n>package</span> <span class=n>Microsoft</span><span class=p>.</span><span class=py>Azure</span><span class=p>.</span><span class=py>AppConfiguration</span><span class=p>.</span><span class=py>AspNetCore</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// You can get the connection string from Settings &gt; Access Keys blade in Azure portal</span>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>.</span><span class=n>AddAzureAppConfiguration</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;AppConfiguration:ConnectionString&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// ...</span>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Services</span><span class=p>.</span><span class=n>AddAzureAppConfiguration</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// ...</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>UseAzureAppConfiguration</span><span class=p>();</span>
</span></span></code></pre></div><p>En su ejemplo más básico, poco más que añadir. Ahora toca disfrutar de <code>IConfiguration</code> y la inyección de dependencias de .NET.</p><p>Si estamos usando referencias a un Key Vault, nos tocará también configurar la conexión al mismo desde App Configuration.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>.</span><span class=n>AddAzureAppConfiguration</span><span class=p>((</span><span class=n>AzureAppConfigurationOptions</span> <span class=n>options</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>Connect</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;AppConfiguration:ConnectionString&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>ConfigureKeyVault</span><span class=p>((</span><span class=n>AzureAppConfigurationKeyVaultOptions</span> <span class=n>options</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=p>.</span><span class=n>SetCredential</span><span class=p>(</span><span class=k>new</span> <span class=n>DefaultAzureCredential</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Por defecto, al igual que sucedía con <code>AddAzureKeyVault</code>, App Configuration no va a refrescar nuestras claves. Así que toca decidir por clave, cuando queremos que se refresque. En la documentación, se habla de <a href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/enable-dynamic-configuration-aspnet-core?tabs=core5x">poll model</a>, pero también hay disponible otra forma guiada por eventos llamada <a href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/enable-dynamic-configuration-dotnet-core-push-refresh?tabs=windowscommandprompt">push model</a>. De igual modo que sucedía con Key Vault, también hay <a href=https://docs.microsoft.com/en-us/azure/azure-app-configuration/faq#are-there-any-limits-on-the-number-of-requests-made-to-app-configuration>límites en el servicio</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>ConfigureRefresh</span><span class=p>(</span><span class=n>refresh</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>refresh</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>Register</span><span class=p>(</span><span class=s>&#34;YOUR_KEY&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetCacheExpiration</span><span class=p>(</span><span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromMinutes</span><span class=p>(</span><span class=m>1</span><span class=p>));</span>  <span class=c1>// 30 seconds by default</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span></code></pre></div><p>Lo que sí que se puede y parece bastante útil, es condicionar el refresco de todas las claves al cambio de una de ellas. De este modo puedes sentirte libre de hacer los cambios que creas oportunos en App Configuration para, finalmente, cambiar una clave (denominada <em>sentinel</em> o similar) que disparará la actualización del resto.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>ConfigureRefresh</span><span class=p>(</span><span class=n>refresh</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>refresh</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>Register</span><span class=p>(</span><span class=s>&#34;Sentinel&#34;</span><span class=p>,</span> <span class=n>refreshAll</span><span class=p>:</span> <span class=k>true</span><span class=p>)</span>  <span class=c1>// Refresh all keys when Sentinel changes</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetCacheExpiration</span><span class=p>(</span><span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromMinutes</span><span class=p>(</span><span class=m>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span></code></pre></div><p>Como dijimos antes, en App Configuration una clave puede tener distintas versiones según su label, luego parece razonable filtrar por label durante la inicialización del proveedor de configuración.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>KeyFilter</span><span class=p>.</span><span class=n>Any</span><span class=p>);</span>  <span class=c1>// Select all keys</span>
</span></span><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>KeyFilter</span><span class=p>.</span><span class=n>Any</span><span class=p>,</span> <span class=s>&#34;prod&#34;</span><span class=p>);</span>  <span class=c1>// When available, give me keys with label prod</span>
</span></span></code></pre></div><p>Tanto el filtro por claves como por labels, permiten wildcards.</p><p>App Configuration va un paso más allá de configuración y referencias a Key Vault, también nos permite hacer una gestión de las feature toggles de nuestra aplicación. Si quieres ubicar mejor en el mapa a las feature toggles, te recomiendo <a href=https://www.serginet.com/2022/02/feature-flags-o-deployment-rings.html>leer este post</a>.</p><p>El concepto detrás de las feature toggles es tener una clave activada o desactivada, y hacer una cosa (o dejar de hacerlo) en función del valor de la misma.</p><p>Lo primero es decirle a App Configuration que queremos usar las feature toggles.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>UseFeatureFlags</span><span class=p>((</span><span class=n>FeatureFlagOptions</span> <span class=n>options</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// By default, 30 seconds is used as the cache expiration time.</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=p>.</span><span class=n>CacheExpirationInterval</span> <span class=p>=</span> <span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromMinutes</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>builder</span><span class=p>.</span><span class=n>Services</span><span class=p>.</span><span class=n>AddFeatureManagement</span><span class=p>();</span>
</span></span></code></pre></div><p>A continuación, y esto es la magia que nos brinda App Configuration, podremos condicionar la ejecución de una acción de un controlador a que esté o no activada una feature toggle. También nos permite preguntar de forma imperativa por el estado de la feature toggle.</p><p>Para usar <code>IFeatureManagerSnapshot</code> debemos agregar un nuevo paquete:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>dotnet</span> <span class=n>add</span> <span class=n>package</span> <span class=n>Microsoft</span><span class=p>.</span><span class=py>FeatureManagement</span><span class=p>.</span><span class=py>AspNetCore</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.AspNetCore.Mvc</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.FeatureManagement</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.FeatureManagement.Mvc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>WebApplication1.Controllers</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>[ApiController]</span>
</span></span><span class=line><span class=cl><span class=na>[Route(&#34;[controller]</span><span class=s>&#34;)]
</span></span></span><span class=line><span class=cl><span class=s></span><span class=k>public</span> <span class=k>class</span> <span class=nc>FeatureFlagController</span> <span class=p>:</span> <span class=n>ControllerBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>readonly</span> <span class=n>IFeatureManagerSnapshot</span> <span class=n>_featureManagerSnapshot</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=n>FeatureFlagController</span><span class=p>(</span><span class=n>IFeatureManagerSnapshot</span> <span class=n>featureManagerSnapshot</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_featureManagerSnapshot</span> <span class=p>=</span> <span class=n>featureManagerSnapshot</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [HttpGet(&#34;feature_gate&#34;)]</span>
</span></span><span class=line><span class=cl><span class=na>    [FeatureGate(&#34;feature1&#34;)]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>string</span> <span class=n>GetWithFeatureGate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// If feature1 is disabled, 404 will be sended to the client.</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Feature1 is enabled using a feature gate&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [HttpGet(&#34;feature_manager_snapshot&#34;)]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=kt>string?</span><span class=p>&gt;</span> <span class=n>GetWithFeatureManagerSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>await</span> <span class=n>_featureManagerSnapshot</span><span class=p>.</span><span class=n>IsEnabledAsync</span><span class=p>(</span><span class=s>&#34;feature1&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;Feature1 is enabled using feature manager snapshot&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Si queremos, podemos <a href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/use-feature-flags-dotnet-core?tabs=core5x#feature-flag-declaration">hacer el combo</a> de gestionar las features toggles en <code>appsettings.json</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;FeatureManagement&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;feature1&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Las feature toggles también permiten hacer testing A/B, estar activadas durante X tiempo, etc. <a href=https://docs.microsoft.com/en-us/azure/azure-app-configuration/howto-feature-filters-aspnet-core>Parece algo muy potente</a>, pero todavía no lo he probado.</p><p>Y aunque después de todo esto no parece necesario, si todavía quieres guardar tu configuración en base de datos, es relativamente sencillo crear un proveedor de configuración personalizado que haga &ldquo;exactamente&rdquo; lo que tu quieras. Y la clave está en &ldquo;exactamente&rdquo;, porque como decía el tío Ben <em>&ldquo;un gran poder conlleva una gran responsabilidad&rdquo;</em> y ahora serás sólo tú el responsable de agregar complejidad accidental a tu aplicación (que no estoy diciendo que no se haga, ojo, sólo quiero advertir de que un mal uso de algo tan transversal como la configuración podría suponer un problema para el rendimiento de tu aplicación).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>dotnet</span> <span class=n>add</span> <span class=n>package</span> <span class=n>Microsoft</span><span class=p>.</span><span class=py>Data</span><span class=p>.</span><span class=py>SqlClient</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>DatabaseConfigurationSource</span> <span class=p>:</span> <span class=n>IConfigurationSource</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_connectionString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=n>DatabaseConfigurationSource</span><span class=p>(</span><span class=kt>string</span> <span class=n>connectionString</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_connectionString</span> <span class=p>=</span> <span class=n>connectionString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=n>IConfigurationProvider</span> <span class=n>Build</span><span class=p>(</span><span class=n>IConfigurationBuilder</span> <span class=n>builder</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>DatabaseConfigurationProvider</span><span class=p>(</span><span class=n>_connectionString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>DatabaseConfigurationProvider</span><span class=p>:</span> <span class=n>ConfigurationProvider</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_connectionString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=n>DatabaseConfigurationProvider</span><span class=p>(</span><span class=kt>string</span> <span class=n>connectionString</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_connectionString</span> <span class=p>=</span> <span class=n>connectionString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>override</span> <span class=k>void</span> <span class=n>Load</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>using</span> <span class=nn>var</span> <span class=n>connection</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SqlConnection</span><span class=p>(</span><span class=n>_connectionString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>connection</span><span class=p>.</span><span class=n>Open</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>using</span> <span class=nn>var</span> <span class=n>command</span> <span class=p>=</span> <span class=n>connection</span><span class=p>.</span><span class=n>CreateCommand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>command</span><span class=p>.</span><span class=n>CommandText</span> <span class=p>=</span> <span class=s>&#34;SELECT [Key], Value FROM Configuration&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>using</span> <span class=nn>var</span> <span class=n>reader</span> <span class=p>=</span> <span class=n>command</span><span class=p>.</span><span class=n>ExecuteReader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// If we are reloading configuration, we should clear Data first</span>
</span></span><span class=line><span class=cl>        <span class=n>Data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>reader</span><span class=p>.</span><span class=n>Read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>key</span> <span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=k>value</span> <span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Data</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=k>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>static</span> <span class=k>class</span> <span class=nc>DatabaseConfigurationProviderExtensions</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=n>IConfigurationBuilder</span> <span class=n>AddDatabaseConfigurationProvider</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span> <span class=n>IConfigurationBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=kt>string</span> <span class=n>connectionString</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>builder</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=k>new</span> <span class=n>DatabaseConfigurationSource</span><span class=p>(</span><span class=n>connectionString</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Dicho todo lo anterior, me lo he pasado bien escribiendo el post y espero tú también leyéndolo.</p><p>¡Un saludo!</p><div class=blog-tags><a href=https://panicoenlaxbox.com/tags/asp.net/>asp.net</a>&nbsp;
<a href=https://panicoenlaxbox.com/tags/csharp/>csharp</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fpanicoenlaxbox.com%2fpost%2fconfiguration-and-secrets-in-asp-net-core%2f&amp;text=Configuraci%c3%b3n%20y%20secretos%20en%20ASP.NET%20Core%20con%20Azure%20Key%20Vault%20y%20Azure%20App%20Configuration&amp;via=panicoenlaxbox" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fpanicoenlaxbox.com%2fpost%2fconfiguration-and-secrets-in-asp-net-core%2f&amp;title=Configuraci%c3%b3n%20y%20secretos%20en%20ASP.NET%20Core%20con%20Azure%20Key%20Vault%20y%20Azure%20App%20Configuration" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li></ul></div></div></section><h4 class=see-also>Ver también</h4><ul><li><a href=/post/minimal-api-swagger-enum/>Enumerados en Swagger con Minimal APIs</a></li><li><a href=/post/peter/>Peter</a></li><li><a href=/post/azurite-testcontainers/>Azurite con Testcontainers</a></li><li><a href=/post/new-dotnet-test-project/>.NET test project with a single command</a></li><li><a href=/post/nuget-package-azure-devops/>Crear un paquete Nuget y publicarlo en Azure DevOps</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://panicoenlaxbox.com/post/organizacion-proyecto-python/ data-toggle=tooltip data-placement=top title="Organización de un proyecto de Python">&larr; Artículo anterior</a></li><li class=next><a href=https://panicoenlaxbox.com/post/mocking-vs-patching-python/ data-toggle=tooltip data-placement=top title="Mocking vs patching en Python">Artículo siguiente &rarr;</a></li></ul><div class=disqus-comments><button id=show-comments class="btn btn-default" type=button>Mostrar <span class=disqus-comment-count data-disqus-url=https://panicoenlaxbox.com/post/configuration-and-secrets-in-asp-net-core>comentarios</span></button><div id=disqus_thread></div><script type=text/javascript>var disqus_config=function(){this.page.url="https://panicoenlaxbox.com/post/configuration-and-secrets-in-asp-net-core"}</script></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:panicoenlaxbox@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/panicoenlaxbox title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/panicoenlaxbox title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/sergio-le%c3%b3n-gonz%c3%a1lez-49412642 title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Sergio León
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://panicoenlaxbox.com>Programación desordenada</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.115.2</a> alimentada &nbsp;&bull;&nbsp; Tema <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adaptado de <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://panicoenlaxbox.com/js/main.js></script>
<script src=https://panicoenlaxbox.com/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://panicoenlaxbox.com/js/load-photoswipe.js></script>
<script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="panicoenlaxbox-github-io";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//panicoenlaxbox-github-io.disqus.com/count.js async></script></body></html>